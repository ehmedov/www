<?

	$labirint=array 
	(
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 1 , 1 , 0 ),
		array(0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 ),
		array(0 , 0 , 1 , 1 , 1 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 1 , 1 , 1 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 0 ),
		array(0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 ),
		array(0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 ),
		array(0 , 1 , 1 , 1 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 1 , 1 , 1 ),
		array(0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 ),
		array(0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 ),
		array(0 , 0 , 1 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 1 , 1 , 1 , 0 , 1 , 1 , 1 , 0 , 1 , 1 , 1 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 1 , 0 ),
		array(0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 0 , 1 , 0 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 1 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 ),
		array(0 , 0 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 0 , 1 , 0 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 0 ),
		array(0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 ),
		array(0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 1 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 , 0 )
	);

	$sunduk_Array=array("19x28","17x25","15x25","23x6","21x6","19x2","11x1","11x3","15x5","17x5","2x7","1x8","2x9","10x16","10x14","14x14","14x16",
						"14x10","14x12","11x7","1x22","2x21","2x23","11x29","11x27","11x23","14x20","14x18","23x24","21x24");

	$eliks=array("17x5"=>array("scroll"=>array(0,1,2,59,11)));

	$Items_Array=array(array(type=>"fontan",coord=>"2x15"),array(type=>"bones",coord=>"4x3"),array(type=>"bones",coord=>"4x27"));
	
	$Bot_Names=array("zorapter"=>"Зораптер","polzun"=>"Ползун","yawer"=>"Ящер","brumbo"=>"Брумбо","baqron"=>"Багрон","korol"=>"Король Скелетов",
	"vampire"=>"Вампир","tantal"=>"Тантал","otto"=>"Отто","verwolf"=>"Вервольф","qarqoniy"=>"Гаргоний","poison_zombie"=>"Ядовитый Зомби",
	"time_ghost"=>"Призрак Времени","bot_lord"=>"Огр Лорд","keymaster"=>"Привратник","devil_shadow"=>"Дьявольская Тень","lich"=>"Лич","stone_gar"=>"Горгулья");

	$Bot_Array=array("27x15"=>array("tantal","otto","tantal"),"25x13"=>array("poison_zombie","otto","poison_zombie"),"27x13"=>array("time_ghost","bot_lord","qarqoniy","time_ghost"),
	"26x12"=>array("devil_shadow","verwolf","devil_shadow"),"25x11"=>array("polzun","polzun","poison_zombie","polzun","polzun"),"24x10"=>array("bot_lord","time_ghost","bot_lord"),
	"22x9"=>array("verwolf"),"22x6"=>array("baqron","otto","baqron"),"22x4"=>array("yawer"),"21x3"=>array("time_ghost"),"19x3"=>array("bot_lord","zorapter","bot_lord"),
	"17x3"=>array("zorapter"),"15x3"=>array("baqron"),"13x2"=>array("qarqoniy","time_ghost","qarqoniy"),"10x2"=>array("keymaster","korol","keymaster"),
	"8x3"=>array("devil_shadow","devil_shadow","devil_shadow"),"8x5"=>array("bot_lord","vampire","bot_lord"),"7x6"=>array("keymaster","keymaster","keymaster"),
	"5x6"=>array("baqron"),"4x7"=>array("bot_lord","otto","bot_lord"),"2x8"=>array("korol","korol","korol","korol"),"4x9"=>array("keymaster","keymaster","keymaster"),
	"5x10"=>array("tantal"),"6x11"=>array("otto"),"6x13"=>array("bot_lord","bot_lord","bot_lord"),"6x16"=>array("time_ghost","time_ghost","time_ghost"),
	"7x15"=>array("poison_zombie","poison_zombie","poison_zombie","poison_zombie"),"9x15"=>array("yawer","bot_lord","yawer"),"11x15"=>array("keymaster","bot_lord","keymaster"),
	"13x15"=>array("keymaster","korol","keymaster"),"15x15"=>array("keymaster","keymaster","tantal","keymaster","keymaster"),"18x15"=>array("polzun","korol","polzun"),
	"21x15"=>array("verwolf","devil_shadow","verwolf"),"22x14"=>array("tantal","otto","tantal"),"23x12"=>array("polzun","polzun","poison_zombie","polzun"),
	"25x15"=>array("keymaster","korol","keymaster"),"25x17"=>array("baqron","otto","baqron"),"22x16"=>array("otto"),"23x18"=>array("otto","otto","otto"),
	"26x18"=>array("korol","tantal","korol"),"21x10"=>array("baqron","otto","baqron"),"19x11"=>array("otto","polzun","otto"),
	"18x13"=>array("korol","korol","korol","korol"),"17x11"=>array("tantal","otto","tantal"),"15x11"=>array("brumbo","otto","brumbo"),"13x11"=>array("brumbo","brumbo","brumbo"),
	"11x10"=>array("vampire","vampire","vampire"),"11x8"=>array("verwolf","vampire","verwolf"),"13x8"=>array("yawer","vampire","yawer"),"15x8"=>array("devil_shadow","devil_shadow","devil_shadow"),
	"16x6"=>array("bot_lord","vampire","bot_lord"),"6x19"=>array("bot_lord","vampire","bot_lord"),"5x20"=>array("yawer","yawer","yawer"),
	"4x21"=>array("keymaster","poison_zombie","keymaster"),"2x22"=>array("korol","korol","korol","korol"),"4x23"=>array("bot_lord","bot_lord","bot_lord","bot_lord"),
	"6x24"=>array("yawer","bot_lord","yawer"),"8x25"=>array("poison_zombie","poison_zombie","poison_zombie"),"8x27"=>array("qarqoniy","vampire","qarqoniy"),
	"9x28"=>array("vampire","otto","vampire"),"12x28"=>array("tantal","otto","tantal"),"15x27"=>array("baqron","otto","baqron"),"17x27"=>array("yawer","yawer","yawer"),
	"20x27"=>array("otto","otto","otto"),"22x26"=>array("keymaster","korol","keymaster"),"22x23"=>array("yawer","otto","yawer"),"22x21"=>array("baqron","tantal"),
	"21x20"=>array("verwolf","poison_zombie","verwolf"),"19x19"=>array("tantal","otto","tantal"),"18x17"=>array("keymaster","korol","keymaster"),"17x18"=>array("yawer","vampire","yawer"),
	"16x19"=>array("yawer","zorapter","yawer"),"13x19"=>array("brumbo","vampire","brumbo"),"11x20"=>array("brumbo","brumbo","brumbo"),
	"12x22"=>array("verwolf","korol","verwolf"),"14x22"=>array("tantal","otto","tantal"),"16x23"=>array("bot_lord","bot_lord","bot_lord"),"16x26"=>array("brumbo"),"23x20"=>array("vampire"),
	"25x19"=>array("korol","zorapter","korol"),"5x15"=>array("keymaster","tantal","keymaster"),"3x14"=>array("bot_lord","vampire","bot_lord"),
	"1x14"=>array("baqron","otto","baqron"),"1x16"=>array("bot_lord","bot_lord","bot_lord"),"3x16"=>array("korol","korol","korol"),"4x5"=>array("lich","lich","lich"),
	"4x25"=>array("stone_gar"),"5x4"=>array("lich","lich"),"5x2"=>array("lich","lich"),"3x2"=>array("lich","lich"),"3x4"=>array("lich","lich"),
	"3x26"=>array("stone_gar","stone_gar","stone_gar"),"3x28"=>array("stone_gar","stone_gar","stone_gar"),"5x28"=>array("stone_gar","stone_gar","stone_gar"),
	"5x26"=>array("stone_gar","stone_gar","stone_gar"));

//----------------------------------------------------------------
function DrawAllMap($loc,$vec)
{
	global $labirint;
	global $sunduk_Array;
	global $Bot_Array;
	global $users;
	$cord = explode("x",$loc);
	$x = $cord[0];
	$y = $cord[1];
	$vt=array(0,90,180,270);
	$ch=array("right.gif","back.gif","left.gif","top.gif");
	$arrow="<img src='img/podzemka/move/".$ch[array_search($vec,$vt)]."' border=0 alt='Ваше местонахождени'>";
	echo "<table border=0 cellpadding=0 cellspacing=0 bgcolor=#7e898b><tr><td>";
		echo "<table border=0 cellpadding=0 cellspacing=0 bgcolor=#000000 width=100% height=100%>";
		for ($my=-5;$my<7;$my++)
		{
			echo "<tr>";
			for ($mx=-4;$mx<4;$mx++)
			{
				$mxx=floor($x+$mx);
				$myy=floor($y+$my);
				$z=$mxx."x".$myy;
				$itBeInThere = 0;
				$who="";
				if ($users!="")
				foreach($users as $currentValue) 
				{
  					if (in_array ($z, $currentValue)) 
  					{
    					$itBeInThere = 1;
    					$who=$currentValue["login"];
    				}
  				} 
				if ($mxx==$x && $myy==$y)echo"<td width=17 height=17 align=center valign=center bgcolor='#c0c0c0' ".($itBeInThere?"background='img/podzemka/move/user.gif' title='".$who."'":"").($Bot_Array[$mxx."x".$myy]?"background='img/podzemka/misc/bot.gif'":"").">".$arrow."</td>";
				else if (in_array ($z, $sunduk_Array)) echo"<td width=17 height=17 align=center valign=center bgcolor='#c0c0c0' background='img/podzemka/misc/sunduk.gif' title='Сундук'></td>";
				else if ($itBeInThere)echo"<td width=17 height=17 align=center valign=center bgcolor=#c0c0c0 ".($Bot_Array[$mxx."x".$myy]?"background='img/podzemka/misc/bot.gif'":"")."><img src='img/podzemka/move/user.gif' border=0 alt='".$who."'></td>";
				else if ($Bot_Array[$mxx."x".$myy])echo"<td width=17 height=17 align=center valign=center bgcolor=#c0c0c0><img src='img/podzemka/misc/bot.gif'  alt='Подземные существа' border=0></td>";
				else if ($labirint[$mxx][$myy]==1)echo'<td width=17 height=17 align=center valign=center bgcolor=#c0c0c0></td>';
				else echo'<td width=17 height=17 align=center valign=center></td>';	
			}
			echo "</tr>";
		} 
		echo "</table>";
	echo "</td></tr></table>";

}
//----------------------------------------------------------------
function next_step($location,$vector)
{
	global $labirint;
	$cord = explode("x",$location);
	$row=$cord[0];
	$col=$cord[1];
	$cell=array();

	// fwd
	$c=$col;
	$r=$row;
	if($vector==90) $c=$col+1;
	else if($vector==180) $r=$row-1;
	else if($vector==270) $c=$col-1;
	else $r=$row+1;
	$cell['fwd']=$r."x".$c;
	$cell['fwd_cord']=$r."x".$c;
	if($labirint[$r][$c]==0) $cell['fwd']=false;
	
	// left
	$c=$col;
	$r=$row;
	if($vector==90) $r=$row+1;
	else if($vector==180) $c=$col+1;
	else if($vector==270) $r=$row-1;
	else $c=$col-1;
	$cell['left']=$r."x".$c;
	$cell['left_cord']=$r."x".$c;
	if($labirint[$r][$c]==0) $cell['left']=false;
	
	// right
	$c=$col;
	$r=$row;
	if($vector==90) $r=$row-1;
	else if($vector==180) $c=$col-1;
	else if($vector==270) $r=$row+1;
	else $c=$col+1;
	$cell['right']=$r."x".$c;
	$cell['right_cord']=$r."x".$c;
	if($labirint[$r][$c]==0) $cell['right']=false;
	
	return $cell;
}
?>